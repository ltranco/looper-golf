{% extends "layout.html" %}
{% block content %}


<div class="events-detail-view">
    <div class="event-meta-data org-shadow">
        <h1>{{ event_name }}{% if event_private %}<span class="private-event">(private event)</span>{% endif %}</h1>
        <h4>{{ event_loc }}</h4>
        <h6>{{ event_date }}</h6>
        <p>{{ event_desc }}</p>
    </div>

    <div class="text-center">
        {% if not org_status and not event_private%}
            {% if unregister %}
                <a class="btn btn-primary red-button" href="/clubs/{{org_id}}/events/{{event_id}}/unregister">Unregister</a>
            {% else %}
                <a class="btn btn-primary" href="/clubs/{{org_id}}/events/{{event_id}}/register">Register</a>
            {% endif %}
        {% endif %}
        <a class="btn btn-default" href="/clubs/{{org_id}}">All Events</a>
        <a class="btn btn-default" href="/">Home</a>
    </div>

    
    {% if participants %}
        <div class="org-shadow event-player-list">
            <p>{{ participants|length }} person(s) registered for this event:</p>
            
            {% if org_status %}
                <ul class="player-list" id="sortable">
                    {% for p in participants %}
                        <li class="sortedPlayer">
                            {{ p.username }}
                            {% if not p.firstname and not p.lastname %}
                                <span>Name: Unspecified</span>
                            {% else %}
                                <span>Name: {{ p.firstname}} {{p.lastname}}</span>
                            {% endif %}
                            <span>Email: <a href="mailto:{{ p.email }}">{{ p.email }}</a></span>
                        </li>
                    {% endfor %}
                </ul>
                <div class="text-center">
                    <a id="sortedPlayersList" class="btn btn-primary">Save Current Order</a>
                </div>
            {% else %}
                <ul class="player-list">
                    {% for p in participants %}
                        <li>{{ p.username }}</li>
                    {% endfor %}
                </ul>
            {% endif %}  
        </div>
    {% endif %}
    <div class="org-shadow event-email-blast">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <input type="text" class="form-control" name="message_subject" placeholder="Subject"/>
                <textarea class="form-control" row="5" name="message_body" placeholder="Send a message to those who signed up."></textarea>
                <label><input type="checkbox" name="message_html" value="checked">Check if this is an HTML email</label>
                <input type="submit" class="btn btn-primary" name="blast_emails" value="Blast Email"/>
            </div>
        </form>
    </div>

    {% if email_blast_success %}
    <div class="alert alert-success">
        <p>Emails sent!</p>
    </div>
    {% endif %}
</div>
<script>
    $(function() {
        $("#sortable").sortable();
        $("#sortable").disableSelection();
        $("#sortedPlayersList").click(function() {
            var playersObject = $(".sortedPlayer");
            var players = [];
            for(var i = 0; i < playersObject.length; i++) {
                players.push(playersObject[i].innerText);
            }
            window.location.href="rearrange?p=" + players.join();
        });
    });
</script>
{% endblock %}